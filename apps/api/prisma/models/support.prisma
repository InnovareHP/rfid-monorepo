model SupportTicket {
  id String @id @default(uuid())
  ticketNumber String @unique @default(dbgenerated("generate_ticket_number()"))
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  title String
  subject String
  description String
  category TicketCategory @default(GENERAL)
  status TicketStatus @default(OPEN)
  priority Priority @default(MEDIUM)
  assignedTo String
  assignedToUser user_table @relation("SupportTicketAssignedTo", fields: [assignedTo], references: [id])

  createBy String
  createByUser user_table @relation("SupportTicketCreateBy", fields: [createBy], references: [id])

  SupportTicketMessage SupportTicketMessage[] @relation("SupportTicketMessage")
  SupportHistory SupportHistory[] @relation("SupportTicketHistory")
  SupportTicketRating SupportTicketRating? @relation("SupportTicketRating")

  @@schema("support_schema")
}

model SupportHistory {
  id String @id @default(uuid())
  createdAt DateTime @default(now())
  message String
  changeType HistoryChangeType @default(MESSAGE_SENT)
  sender String
  senderUser user_table @relation("SupportHistorySender", fields: [sender], references: [id])

  supportTicketId String
  supportTicket SupportTicket @relation("SupportTicketHistory", fields: [supportTicketId], references: [id])

  @@schema("support_schema")
}

model SupportTicketRating {
  id String @id @default(uuid())
  createdAt DateTime @default(now())
  rating Int
  comment String?

  supportTicketId String @unique
  supportTicket SupportTicket @relation("SupportTicketRating", fields: [supportTicketId], references: [id], onDelete: Cascade)

  createdBy String
  createdByUser user_table @relation("SupportTicketRatingCreatedBy", fields: [createdBy], references: [id])

  @@schema("support_schema")
}


model SupportTicketMessage {
  id String @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  message String
  sender String
  senderUser user_table @relation("SupportTicketMessageSender", fields: [sender], references: [id])
  supportTicketId String
  supportTicket SupportTicket @relation("SupportTicketMessage", fields: [supportTicketId], references: [id])
  SupportTicketAttachment SupportTicketAttachment[] @relation("SupportTicketAttachment")

  @@schema("support_schema")
}

model SupportTicketAttachment {
  id String @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  imageUrl String
  supportTicketMessageId String
  supportTicketMessage SupportTicketMessage @relation("SupportTicketAttachment", fields: [supportTicketMessageId], references: [id])

  @@schema("support_schema")
}

model SupportLiveChat {
  id String @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  message String
  sender String
  senderUser user_table @relation("SupportLiveChatSender", fields: [sender], references: [id])

  messages SupportLiveChatMessage[] @relation("SupportLiveChatMessage")
  attachments SupportLiveChatAttachment[] @relation("SupportLiveChatAttachment")

  @@schema("support_schema")
}

model SupportLiveChatMessage {
  id String @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  message String
  sender String
  senderUser user_table @relation("SupportLiveChatMessageSender", fields: [sender], references: [id])
  supportLiveChatId String
  supportLiveChat SupportLiveChat @relation("SupportLiveChatMessage", fields: [supportLiveChatId], references: [id])

  @@schema("support_schema")
}

model SupportLiveChatAttachment {
  id String @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  imageUrl String
  sender String
  senderUser user_table @relation("SupportLiveChatAttachmentSender", fields: [sender], references: [id])
  supportLiveChatId String
  supportLiveChat SupportLiveChat @relation("SupportLiveChatAttachment", fields: [supportLiveChatId], references: [id])

  @@schema("support_schema")
}

enum TicketStatus {
  OPEN
  CLOSED
  IN_PROGRESS
  RESOLVED

  @@schema("support_schema")
}

enum Priority {
  LOW
  MEDIUM
  HIGH

  @@schema("support_schema")
}

enum TicketCategory {
  GENERAL
  TECHNICAL
  ACCOUNT
  OTHER

  @@schema("support_schema")
}

enum HistoryChangeType {
  CREATED
  STATUS_CHANGED
  ASSIGNED
  MESSAGE_SENT
  PRIORITY_CHANGED
  CLOSED
  REOPENED
  RATED

  @@schema("support_schema")
}
